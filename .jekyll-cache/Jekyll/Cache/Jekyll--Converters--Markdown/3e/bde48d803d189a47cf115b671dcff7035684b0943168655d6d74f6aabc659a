I"p<h2 id="版本">版本：</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: center">日期</th>
      <th style="text-align: center">版號</th>
      <th style="text-align: center">備註</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">2021-09-02</td>
      <td style="text-align: center">2021090005</td>
      <td style="text-align: center">初版</td>
    </tr>
  </tbody>
</table>

<h2 id="說明">說明：</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>當前端使用反向代理機制作為代理RTE服務時，時常因為操作系統靜止時間過久，被踢出系統。
</code></pre></div></div>

<h2 id="環境需求">環境需求：</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: center">項目</th>
      <th style="text-align: center">內容</th>
      <th style="text-align: center">備註</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">帳號</td>
      <td style="text-align: center">請準備站台安裝所屬伺服器的系統管理員帳號</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center">RTE</td>
      <td style="text-align: center">8.10.0 及以後版本</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center">反向代理服務</td>
      <td style="text-align: center">以nginx為例</td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<h2 id="問題說明">問題說明：</h2>

<p>基於服務統一管理或是安全通訊需求，會在RTE前端增加反向代理服務，以便代理內部RTE服務提供給外部使用者使用，而由於安全考量多數反向代理服務都有連線timeout時間設定及預設值，如果發現時常被踢出系統可能是timeout時間過短所致，以下說明如何確認問題，並以nginx作為反向代理服務時如何設定timeout時間設定。</p>

<h3 id="1-檢查問題">1. 檢查問題</h3>

<p>開啟開發人員工具，檢查console是否短時間重複出現websocket連線中斷！</p>

<p><img src="img/001.png" alt="alt Websocket連線中斷" /></p>

<p>而站台管理中[企業設定] &gt; [系統閒置登出時間]設定時間大於被踢時間</p>

<p><img src="img/002.png" alt="alt 系統閒置時間設定" /></p>

<h3 id="2-解決方式">2. 解決方式</h3>

<p>修改timeout時間以便符合你們的使用習慣，RTE如果websocket被中斷五次過程中使用者都沒有執行與伺服端的互動例如新增、修改、查詢、刪除，使用者帳號就會被踢出系統，因此適度調整timeout可以讓你避免發生服務中斷，以nginx為例，預設值為60秒中斷五次是5分鐘，基於安全考量建議可以修改為75秒則中斷五次是6分秒。</p>

<p>請於 server{}標籤中的location增加proxy_connect_timeout設定，如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location /ArcarEng/ {
    proxy_pass http://backend/ArcarEng;
    proxy_connect_timeout 75s;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
</code></pre></div></div>

<h3 id="3-完成後請重啟反向代理服務以nginx為例">3. 完成後請重啟反向代理服務(以nginx為例)</h3>
:ET